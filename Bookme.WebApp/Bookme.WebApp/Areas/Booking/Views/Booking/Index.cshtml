@model int

<div class="row" id="@Model">
    <div class="col-md-6 offset-md-3">
        <div class="md-form md-outline input-with-post-icon datepicker">
            <label for="example">Choose a date: </label>
            <input placeholder="Select date" type="date" id="date" class="form-control">
        </div>
        <div class="schedule d-none" id="hours">

        </div>
        <div class="form-group text-center m-3">
            <button class="btn btn-primary" id="Chek_button">Check!</button>
        </div>
    </div>
</div>

@section Scripts {
<script>
    let buttonEl = document.getElementById('Chek_button')


    buttonEl.addEventListener('click', clicked)

    function clicked(e) {
        let date = document.getElementById('date').value;
        let hoursEl = document.getElementById('hours');
        hoursEl.innerHTML = date;
        hoursEl.classList.remove('d-none');

        let url = `/api/bookings/${2}/${'2021-06-15'} `;
        const httpRequest = new XMLHttpRequest();

        httpRequest.addEventListener('loadend', loadInfo);

        function loadInfo(e) {
            if (httpRequest.status === 200) {                
                let data = JSON.parse(httpRequest.responseText);
                if (data.bookedHours.length) {
                    console.log('empty')
                }

                let shiftStart = data.ownerInfo.shiftStart.totalMinutes;
                let shiftEnd = `${data.ownerInfo.shiftEnd.hours}:${data.ownerInfo.shiftEnd.minutes}`;

                let workingDay = data.ownerInfo.shiftEnd.totalMinutes - data.ownerInfo.shiftStart.totalMinutes;
                let numberOfPossibleServices = Math.round(workingDay / 50)

                let ulEl = document.createElement('div');
                
                for (var i = 0; i < numberOfPossibleServices; i++) {
                    let liEl = document.createElement('button');
                    liEl.id = i;
                    liEl.classList.add('btn');
                    liEl.classList.add('m-3');
                    liEl.classList.add('btn-success');
                    liEl.classList.add('col-2');
                    liEl.innerText = `${Math.floor(shiftStart / 60)}:${Math.round(((shiftStart / 60) - Math.floor(shiftStart / 60)) * 60)}`;
                    shiftStart += data.ownerInfo.serviceInterval

                    ulEl.appendChild(liEl);
                }
                hoursEl.appendChild(ulEl);

                console.log(numberOfPossibleServices)
                console.log(data.ownerInfo)
            }
            else {
                console.log('error')
            }
        }

        httpRequest.open('GET', url);
        httpRequest.send();
    }

    //function getInfo() {

    //    let url = `/api/booking/${id}, ${} `;
    //    const httpRequest = new XMLHttpRequest();

    //    httpRequest.addEventListener('loadend', loadInfo);

    //    function loadInfo(e) {
    //        resultBuses.innerHTML = '';
    //        if (httpRequest.status === 200) {
    //            let obj = JSON.parse(httpRequest.responseText);
    //            resultStop.innerText = obj.name;
    //            Object.entries(obj.buses).forEach(bus => {
    //                let liElement = document.createElement('li');
    //                liElement.innerText = `Bus ${bus[0]} arrives in ${bus[1]}`;
    //                resultBuses.appendChild(liElement);
    //            })
    //        } else {
    //            resultStop.innerText = 'Error';
    //        }
    //    }

    //    httpRequest.open('GET', url);
    //    httpRequest.send();
    //}

</script>
}
